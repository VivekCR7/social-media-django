{% extends "post/base.html" %}

{% load static %}
{% load crispy_forms_tags %}
{% block content%}

<div class="border-0 border-start border-2 ps-2" id="{{comment.id}}">

    <div class="mt-3">
        <strong>@{{comment.author}}</strong> 
        {% if  comment.parent.author%} to <strong>@{{comment.parent.author}}</strong>{% endif %}
    </div>
    <div class="border-none">
        <p>{{comment.content}}</p>
        <button class="btn btn-primary btn-sm" onclick="handleReply({{comment.id}})">Reply</button>
        <!-- <button type="submit" class="btn btn-danger btn-sm">Delete</button> -->
    
        <div id="reply-form-container-{{comment.id}}" style="display:none">
        
            <form method="post" action="{% url 'reply' %}" class="mt-3">
                {% csrf_token %}
                <input type="hidden" name="post_id" value="{{post.id}}">
                <input type="hidden" name="parent" value="{{comment.id}}">
                <input type="hidden" name="post_url" value="{{post.get_absolute_url}}">


                {{comment_form|crispy}}

                <div>
                    <button type="button" onclick="handleCancel({{comment.id}})" class="btn btn-light border btn-sm">Cancel</button>
                    <button type="submit" class="btn btn-primary btn-sm">Submit</button>
                </div>
            </form>
        </div>
    </div>
    {% for comment in comment.get_comments %}
        {% include 'post/comment.html' with comment=comment %}
    {% endfor %}
</div>

<script>
function handleReply(response_id) {
    const reply_form_container = document.querySelector(`#reply-form-container-${response_id}`)
    if (reply_form_container) {
        reply_form_container.style.display = 'block';
    }
}
function handleCancel(response_id) {
    const reply_form_container = document.querySelector(`#reply-form-container-${response_id}`)
    if (reply_form_container) {
        reply_form_container.style.display = 'none';
    }
}
</script>

{% endblock content%}